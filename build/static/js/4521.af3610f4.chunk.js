"use strict";(self.webpackChunkyour_app=self.webpackChunkyour_app||[]).push([[4521],{3520:function(t,e,n){n.r(e),n.d(e,{default:function(){return ot}});var r=n(2791),c="Support_chat_wrapper__8hf9N",s="Support_chat_contacts__C5H2I",a="Support_chat_contact_card__Ol9rB",u="Support_archive_handler__e6qKA",o="Support_active__GfWu4",i="Support_is_not_running__LzZSd",_="Support_chevron_rotated__IYB51",p="Support_archive_tickets__BTKR9",l="Support_first__Y-q5-",d="Support_chat_contact_wrapper__3nCTF",f="Support_chat_contact_data__jalI+",v="Support_chat_contact_name__yJMTC",h="Support_chat_contact_last_message__OHk4l",m="Support_chat_messages__1duyI",k="Support_chat_messages_messages__zEflC",g="Support_message_wrapper__13SDL",x="Support_is_mine__0X+WP",j="Support_user_avatar__nLX91",y="Support_message_body__oOdjW",w="Support_message_header__K9nqb",S="Support_message_author_name__zqQwo",N="Support_message_date_time__mcGSs",Z="Support_message_text__NPsdz",b="Support_send_button__-HEwu",C="Support_tickets_button__r0erg",E=n(364),T=n(885),F=n(5087),I=n(5861),W=n(7757),$=n.n(W),A=n(3605),O=n(4569),z=n.n(O),D=function(){return function(){var t=(0,I.Z)($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:A.cxF});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},J=function(){return function(){var t=(0,I.Z)($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:A.WLf});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},L=function(){return function(){var t=(0,I.Z)($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:A.Qai});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},H=function(t){return function(){var e=(0,I.Z)($().mark((function e(n){var r,c;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},null,e.prev=2,e.next=5,z().patch("".concat("https://traveler.market","/api/support_tickets/").concat(t,"/close_ticket/"),null,r);case 5:c=e.sent,n({type:A.DxN,payload:c.data}),n(L()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.error(e.t0),n({type:A.o_8,payload:e.t0.response.data});case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}()},K=function(){return function(){var t=(0,I.Z)($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:A.GoZ});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},q=n(2948),G=n(8087),R=n(184),B=(0,E.$j)((function(t){return{}}),{})((function(t){var e=t.action,n=(0,r.useRef)(),c=(0,r.useRef)(),s=function(t){o?(t.preventDefault(),e(o),i("")):t.preventDefault()},a=(0,r.useState)(""),u=(0,T.Z)(a,2),o=u[0],i=u[1];return(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)("form",{ref:c,onSubmit:s,children:[(0,R.jsx)(q.Z,{ref:n,placeholder:"\u0422\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",onChange:function(t){i(t.target.value)},onKeyDown:function(t){13===t.keyCode&&!1===t.shiftKey&&s(t)},value:o,maxRows:3}),(0,R.jsx)("button",{type:"submit",children:(0,R.jsx)("img",{src:G.Z,alt:""})})]})})})),M=n(4461),P=(0,E.$j)((function(t){return{}}),{})((function(t){var e,n=t.data,c=t.author,s=t.user_id,a=(0,r.useState)(!1),u=(0,T.Z)(a,2),o=u[0],i=u[1];return(0,r.useEffect)((function(){(null===c||void 0===c?void 0:c.id)===s&&i(!0)}),[c]),(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)("div",{className:"".concat(g," ").concat(o?x:""),children:[(0,R.jsx)("div",{className:j,style:{backgroundImage:"url(".concat(null===c||void 0===c?void 0:c.avatar,")")}}),(0,R.jsxs)("div",{className:y,children:[(0,R.jsxs)("div",{className:w,children:[(0,R.jsx)("div",{className:S,children:o?"\u0412\u044b":(null===c||void 0===c?void 0:c.first_name)+" "+(null===c||void 0===c?void 0:c.last_name)}),(0,R.jsx)("div",{className:N,children:n.created_at}),o&&(0,R.jsx)(M.Z,{is_read:n.is_read})]}),(0,R.jsx)("div",{className:Z,dangerouslySetInnerHTML:{__html:null===(e=n.message)||void 0===e?void 0:e.replace(/\n/g,"<br />")}})]})]})})})),Q=(0,E.$j)((function(t){return{user:t.auth.user,current_support_messages:t.support.current_support_messages}}),{})((function(t){var e=t.user,n=t.current_support_messages,c=(0,r.useRef)(null);return(0,r.useEffect)((function(){c&&c.current.addEventListener("DOMNodeInserted",(function(t){var e=t.currentTarget;e.scroll({top:e.scrollHeight,behavior:"smooth"})}))}),[n]),(0,R.jsx)(R.Fragment,{children:(0,R.jsx)("div",{ref:c,className:k,children:null===n||void 0===n?void 0:n.map((function(t,n){return(0,R.jsx)(P,{data:t,author:t.author,user_id:e.id},n)}))})})})),X={close_ticket:H},Y=(0,E.$j)((function(t){return{}}),X)((function(t){var e=t.active_ticket,n=void 0!==e&&e,r=t.action;t.close_ticket;return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)("div",{className:C,onClick:function(){r()},children:n?"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443"})})})),V={set_current_support_messages:function(t){return function(){var e=(0,I.Z)($().mark((function e(n){return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:A.oqG,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_support_messages:function(){return function(){var t=(0,I.Z)($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:A.eVH});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_read:function(){return function(){var t=(0,I.Z)($().mark((function t(e){return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:A.EnG});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_unread:K,set_new_ticket:function(t){return function(){var e=(0,I.Z)($().mark((function e(n){var r,c,s;return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},c=JSON.stringify(t),e.prev=2,e.next=5,z().post("".concat("https://traveler.market","/api/support_tickets/"),c,r);case 5:s=e.sent,n({type:A.$1P,payload:s.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),n({type:A.o_8,payload:e.t0.response.data});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},close_ticket:H,clear_current_ticket_status:J,clear_current_ticket:D,set_archive_ticket:L},U=(0,E.$j)((function(t){return{current_ticket:t.support.current_ticket,current_status:t.support.current_status}}),V)((function(t){var e=t.current_ticket,n=t.set_current_support_messages,c=t.clear_current_support_messages,s=t.set_all_support_messages_read,a=t.set_all_support_messages_unread,u=t.current_status,o=t.set_new_ticket,i=t.close_ticket,_=t.clear_current_ticket_status,p=t.clear_current_ticket,l=t.set_archive_ticket,d=(0,r.useState)(!1),f=(0,T.Z)(d,2),v=f[0],h=f[1],k=e?new F.w3cwebsocket("wss://traveler.market/ws/support_chat/".concat(e,"/?token=").concat(localStorage.getItem("access"))):null;(0,r.useEffect)((function(){return function(){c(),null===k||void 0===k||k.close()}})),(0,r.useEffect)((function(){k&&(k.onopen=function(){console.log("WebSocket Client Connected")},k.onclose=function(){console.log("WebSocket Client Disconnected")},k.onerror=function(t){console.error(t),console.log("Connection Error")},k.onmessage=function(t){var e=JSON.parse(t.data);e&&("close_ticket"===(null===e||void 0===e?void 0:e.command)?(null===k||void 0===k||k.close(),l(),_(),p(),c()):"set_read"===(null===e||void 0===e?void 0:e.command)?s():"set_unread"===(null===e||void 0===e?void 0:e.command)?a():n(e))})}),[k]);(0,r.useEffect)((function(){v&&(_(),p(),c())}),[v]);return(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)("div",{className:m,children:[(0,R.jsx)(Y,{active_ticket:u&&3!==u,action:function(){u&&3!==u?(h(!1),i(e),_(),p(),c()):h((function(t){return!t}))}}),(0,R.jsx)(Q,{}),(0,R.jsx)("div",{className:b,children:(u&&3!==u||v)&&(0,R.jsx)(B,{action:function(t){v?(h(!1),o({text:t})):k.send(JSON.stringify({message:t}))},new_ticket:v})})]})})})),tt=n(7714),et=n(5198),nt=(0,E.$j)((function(t){return{}}),{})((function(t){var e=t.ticket,n=t.is_running,c=t.action,s=t.active,u=void 0!==s&&s,_=t.first,p=void 0!==_&&_,m=e.id,k=(e.staff,e.last_message);(0,r.useEffect)((function(){n&&c(m)}),[n]);return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)("div",{className:"".concat(a," ").concat(u?o:""," ").concat(n?"":i," ").concat(p?l:""),onClick:function(){c(e)},children:(0,R.jsx)("div",{className:d,children:(0,R.jsxs)("div",{className:f,children:[(0,R.jsx)("div",{className:v,children:"\u0417\u0430\u044f\u0432\u043a\u0430 \u2116".concat(m)}),(0,R.jsx)("div",{className:h,children:(0,et.aF)(k,20)})]})})})})}));var rt=n.p+"static/media/chevron_down.7ef6027d1679a7f457f31c202b92a83c.svg",ct={clear_current_ticket:D,set_all_support_messages_unread:K,set_current_ticket:function(t){return function(){var e=(0,I.Z)($().mark((function e(n){return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:A.KLx,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},set_current_ticket_status:function(t){return function(){var e=(0,I.Z)($().mark((function e(n){return $().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:A.sg9,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_ticket_status:J},st=(0,E.$j)((function(t){return{all_tickets:t.support.all_tickets,current_ticket:t.support.current_ticket,running_ticket:t.support.running_ticket,archive_tickets:t.support.archive_tickets}}),ct)((function(t){var e=t.clear_current_ticket,n=t.set_all_support_messages_unread,c=t.set_current_ticket,o=t.current_ticket,i=t.running_ticket,l=t.archive_tickets,d=t.set_current_ticket_status,f=(0,r.useState)(!1),v=(0,T.Z)(f,2),h=v[0],m=v[1];(0,r.useEffect)((function(){i&&(c(i.id),d(i.status))}),[i]);var k=function(t){e(),n(),c(t.id),d(t.status)};return(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)("div",{className:s,children:[i&&(0,R.jsx)(nt,{ticket:i,action:k,is_running:!0,active:o===i.id,first:!0}),(0,R.jsxs)("div",{className:"".concat(a," ").concat(u),onClick:function(){return m((function(t){return!t}))},children:[(0,R.jsx)("div",{children:"\u0410\u0440\u0445\u0438\u0432 \u0437\u0430\u044f\u0432\u043e\u043a"}),(0,R.jsx)("div",{className:h?_:"",children:(0,R.jsx)("img",{src:rt,alt:""})})]}),(0,R.jsx)("div",{className:p,children:h&&(null===l||void 0===l?void 0:l.map((function(t,e){return(0,R.jsx)(nt,{ticket:t,action:k,is_running:(null===i||void 0===i?void 0:i.id)===t.id,active:o===t.id,first:0===e},e)})))})]})})})),at={get_all_tickets:function(){return function(){var t=(0,I.Z)($().mark((function t(e){var n,r;return $().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},t.prev=1,t.next=4,z().get("".concat("https://traveler.market","/api/support_tickets/\n"),n);case 4:r=t.sent,e({type:A.OSA,payload:r.data}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0),e({type:A.jt7,payload:t.t0.response.data});case 12:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},clear_current_ticket:D,set_all_support_messages_unread:K,clear_current_ticket_status:J},ut=(0,E.$j)((function(t){return{}}),at)((function(t){var e=t.get_all_tickets,n=t.clear_current_ticket,s=t.set_all_support_messages_unread,a=t.clear_current_ticket_status;return(0,r.useEffect)((function(){return window.scrollTo(0,0),e(),function(){a(),n(),s()}}),[]),(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(tt.Z,{title:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430",menu_item:"support",page:"support",children:(0,R.jsxs)("div",{className:c,children:[(0,R.jsx)(st,{}),(0,R.jsx)(U,{})]})})})})),ot=ut}}]);
//# sourceMappingURL=4521.af3610f4.chunk.js.map