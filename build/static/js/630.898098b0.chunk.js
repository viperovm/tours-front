"use strict";(self.webpackChunkyour_app=self.webpackChunkyour_app||[]).push([[630],{7685:function(t,e,n){n(2791);e.Z=n.p+"static/media/read.b04a436fbb2273beb727df41f65dbec8.svg"},4553:function(t,e,n){n(2791);e.Z=n.p+"static/media/read_not.8d47eda62723e55aa33be26f7f9f559b.svg"},8087:function(t,e,n){n(2791);e.Z=n.p+"static/media/send.929e4d6a84f91e0b008c783e66027df5.svg"},7714:function(t,e,n){var a=n(885),r=n(2791),s=n(2753),c=n(1642),o=n(7571),i=n(9741),u=n(364),_=n(5039),p=n(7880),l=n(7258),d=n(184);e.Z=(0,u.$j)((function(t){return{isAuthenticated:t.auth.isAuthenticated,user:t.auth.user,status:t.auth.status,page:t.auth.page,tour:t.tours.current_tour}}),{load_user:p.L4,openSecondaryMenu:l.E3})((function(t){var e=t.title,n=t.subtitle,u=t.menu_item,l=t.isAuthenticated,f=t.children,h=t.tour,m=t.openSecondaryMenu;if(!l)return(0,d.jsx)(o.l_,{to:"/login"});h.secondary&&m(!1);var v=(0,r.useState)(""),g=(0,a.Z)(v,2);g[0],g[1];return(0,r.useEffect)((function(){(0,p.L4)()}),[]),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(c.ZP,{children:[(0,d.jsx)("title",{children:e}),(0,d.jsx)("meta",{name:"description",content:""}),(0,d.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,d.jsxs)(s.Z,{page:u,children:[(0,d.jsx)("section",{children:(0,d.jsx)("div",{className:"wrapper",children:(0,d.jsxs)("div",{className:"breadcrumbs breadcrumbs_margin",children:[(0,d.jsx)("span",{children:(0,d.jsx)(i.rU,{to:"/",children:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"})})," - ",(0,d.jsx)("span",{children:(0,d.jsx)(i.rU,{to:"/account",children:"\u041b\u0438\u0447\u043d\u044b\u0439 \u043a\u0430\u0431\u0438\u043d\u0435\u0442"})}),n&&" - ",n&&(0,d.jsx)("span",{children:(0,d.jsx)(i.rU,{to:"/account/".concat(u),children:n})}),e&&" - ",(0,d.jsx)("span",{style:{textDecoration:"none",pointerEvents:"none"},children:e})]})})}),(0,d.jsx)("section",{children:(0,d.jsx)("div",{className:"wrapper",children:(0,d.jsxs)("div",{className:"account_block",children:[(0,d.jsx)(_.Z,{menu_item:u}),f]})})})]})]})}))},4461:function(t,e,n){n(2791);var a=n(5774),r=n(7685),s=n(4553),c=n(364),o=n(184);e.Z=(0,c.$j)((function(t){return{all_messages_read:t.chat.all_messages_read}}))((function(t){var e=t.is_read,n=t.all_messages_read;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("div",{className:a.Z.message_status,children:(0,o.jsx)("img",{src:e||n?r.Z:s.Z,alt:""})})})}))},3520:function(t,e,n){n.r(e),n.d(e,{default:function(){return it}});var a=n(2791),r="Support_chat_wrapper__8hf9N",s="Support_chat_contacts__C5H2I",c="Support_chat_contact_card__Ol9rB",o="Support_archive_handler__e6qKA",i="Support_active__GfWu4",u="Support_is_not_running__LzZSd",_="Support_chevron_rotated__IYB51",p="Support_archive_tickets__BTKR9",l="Support_first__Y-q5-",d="Support_chat_contact_wrapper__3nCTF",f="Support_chat_contact_data__jalI+",h="Support_chat_contact_name__yJMTC",m="Support_chat_contact_last_message__OHk4l",v="Support_chat_messages__1duyI",g="Support_chat_messages_messages__zEflC",x="Support_message_wrapper__13SDL",k="Support_is_mine__0X+WP",j="Support_user_avatar__nLX91",y="Support_message_body__oOdjW",w="Support_message_header__K9nqb",S="Support_message_author_name__zqQwo",C="Support_message_date_time__mcGSs",b="Support_message_text__NPsdz",Z="Support_send_button__-HEwu",N="Support_tickets_button__r0erg",E=n(364),I=n(885),L=n(5087),F=n(5861),A=n(7757),R=n.n(A),T=n(3605),$=n(4569),H=n.n($),q=function(){return function(){var t=(0,F.Z)(R().mark((function t(e){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:T.cxF});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},D=function(){return function(){var t=(0,F.Z)(R().mark((function t(e){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:T.WLf});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},J=function(){return function(){var t=(0,F.Z)(R().mark((function t(e){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:T.Qai});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},W=function(t){return function(){var e=(0,F.Z)(R().mark((function e(n){var a,r;return R().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},null,e.prev=2,e.next=5,H().patch("".concat("https://traveler.market","/api/support_tickets/").concat(t,"/close_ticket/"),null,a);case 5:r=e.sent,n({type:T.DxN,payload:r.data}),n(J()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.error(e.t0),n({type:T.o_8,payload:e.t0.response.data});case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}()},G=function(){return function(){var t=(0,F.Z)(R().mark((function t(e){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:T.GoZ});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},O=n(2948),z=n(8087),K=n(184),Y=(0,E.$j)((function(t){return{}}),{})((function(t){var e=t.action,n=(0,a.useRef)(),r=(0,a.useRef)(),s=function(t){i?(t.preventDefault(),e(i),u("")):t.preventDefault()},c=(0,a.useState)(""),o=(0,I.Z)(c,2),i=o[0],u=o[1];return(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)("form",{ref:r,onSubmit:s,children:[(0,K.jsx)(O.Z,{ref:n,placeholder:"\u0422\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",onChange:function(t){u(t.target.value)},onKeyDown:function(t){13===t.keyCode&&!1===t.shiftKey&&s(t)},value:i,maxRows:3}),(0,K.jsx)("button",{type:"submit",children:(0,K.jsx)("img",{src:z.Z,alt:""})})]})})})),M=n(4461),P=(0,E.$j)((function(t){return{}}),{})((function(t){var e,n=t.data,r=t.author,s=t.user_id,c=(0,a.useState)(!1),o=(0,I.Z)(c,2),i=o[0],u=o[1];return(0,a.useEffect)((function(){(null===r||void 0===r?void 0:r.id)===s&&u(!0)}),[r]),(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)("div",{className:"".concat(x," ").concat(i?k:""),children:[(0,K.jsx)("div",{className:j,style:{backgroundImage:"url(".concat(null===r||void 0===r?void 0:r.avatar,")")}}),(0,K.jsxs)("div",{className:y,children:[(0,K.jsxs)("div",{className:w,children:[(0,K.jsx)("div",{className:S,children:i?"\u0412\u044b":(null===r||void 0===r?void 0:r.first_name)+" "+(null===r||void 0===r?void 0:r.last_name)}),(0,K.jsx)("div",{className:C,children:n.created_at}),i&&(0,K.jsx)(M.Z,{is_read:n.is_read})]}),(0,K.jsx)("div",{className:b,dangerouslySetInnerHTML:{__html:null===(e=n.message)||void 0===e?void 0:e.replace(/\n/g,"<br />")}})]})]})})})),B=(0,E.$j)((function(t){return{user:t.auth.user,current_support_messages:t.support.current_support_messages}}),{})((function(t){var e=t.user,n=t.current_support_messages,r=(0,a.useRef)(null);return(0,a.useEffect)((function(){r&&r.current.addEventListener("DOMNodeInserted",(function(t){var e=t.currentTarget;e.scroll({top:e.scrollHeight,behavior:"smooth"})}))}),[n]),(0,K.jsx)(K.Fragment,{children:(0,K.jsx)("div",{ref:r,className:g,children:null===n||void 0===n?void 0:n.map((function(t,n){return(0,K.jsx)(P,{data:t,author:t.author,user_id:e.id},n)}))})})})),Q={close_ticket:W},U=(0,E.$j)((function(t){return{}}),Q)((function(t){var e=t.active_ticket,n=void 0!==e&&e,a=t.action;t.close_ticket;return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)("div",{className:N,onClick:function(){a()},children:n?"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443"})})})),X={set_current_support_messages:function(t){return function(){var e=(0,F.Z)(R().mark((function e(n){return R().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:T.oqG,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_support_messages:function(){return function(){var t=(0,F.Z)(R().mark((function t(e){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:T.eVH});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_read:function(){return function(){var t=(0,F.Z)(R().mark((function t(e){return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:T.EnG});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_unread:G,set_new_ticket:function(t){return function(){var e=(0,F.Z)(R().mark((function e(n){var a,r,s;return R().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},r=JSON.stringify(t),e.prev=2,e.next=5,H().post("".concat("https://traveler.market","/api/support_tickets/"),r,a);case 5:s=e.sent,n({type:T.$1P,payload:s.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),n({type:T.o_8,payload:e.t0.response.data});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},close_ticket:W,clear_current_ticket_status:D,clear_current_ticket:q,set_archive_ticket:J},V=(0,E.$j)((function(t){return{current_ticket:t.support.current_ticket,current_status:t.support.current_status}}),X)((function(t){var e=t.current_ticket,n=t.set_current_support_messages,r=t.clear_current_support_messages,s=t.set_all_support_messages_read,c=t.set_all_support_messages_unread,o=t.current_status,i=t.set_new_ticket,u=t.close_ticket,_=t.clear_current_ticket_status,p=t.clear_current_ticket,l=t.set_archive_ticket,d=(0,a.useState)(!1),f=(0,I.Z)(d,2),h=f[0],m=f[1],g=e?new L.w3cwebsocket("wss://traveler.market/ws/support_chat/".concat(e,"/?token=").concat(localStorage.getItem("access"))):null;(0,a.useEffect)((function(){return function(){r(),null===g||void 0===g||g.close()}})),(0,a.useEffect)((function(){g&&(g.onopen=function(){console.log("WebSocket Client Connected")},g.onclose=function(){console.log("WebSocket Client Disconnected")},g.onerror=function(t){console.error(t),console.log("Connection Error")},g.onmessage=function(t){var e=JSON.parse(t.data);e&&("close_ticket"===(null===e||void 0===e?void 0:e.command)?(null===g||void 0===g||g.close(),l(),_(),p(),r()):"set_read"===(null===e||void 0===e?void 0:e.command)?s():"set_unread"===(null===e||void 0===e?void 0:e.command)?c():n(e))})}),[g]);(0,a.useEffect)((function(){h&&(_(),p(),r())}),[h]);return(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)("div",{className:v,children:[(0,K.jsx)(U,{active_ticket:o&&3!==o,action:function(){o&&3!==o?(m(!1),u(e),_(),p(),r()):m((function(t){return!t}))}}),(0,K.jsx)(B,{}),(0,K.jsx)("div",{className:Z,children:(o&&3!==o||h)&&(0,K.jsx)(Y,{action:function(t){h?(m(!1),i({text:t})):g.send(JSON.stringify({message:t}))},new_ticket:h})})]})})})),tt=n(7714),et=n(5198),nt=(0,E.$j)((function(t){return{}}),{})((function(t){var e=t.ticket,n=t.is_running,r=t.action,s=t.active,o=void 0!==s&&s,_=t.first,p=void 0!==_&&_,v=e.id,g=(e.staff,e.last_message);(0,a.useEffect)((function(){n&&r(v)}),[n]);return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)("div",{className:"".concat(c," ").concat(o?i:""," ").concat(n?"":u," ").concat(p?l:""),onClick:function(){r(e)},children:(0,K.jsx)("div",{className:d,children:(0,K.jsxs)("div",{className:f,children:[(0,K.jsx)("div",{className:h,children:"\u0417\u0430\u044f\u0432\u043a\u0430 \u2116".concat(v)}),(0,K.jsx)("div",{className:m,children:(0,et.aF)(g,20)})]})})})})}));var at=n.p+"static/media/chevron_down.7ef6027d1679a7f457f31c202b92a83c.svg",rt={clear_current_ticket:q,set_all_support_messages_unread:G,set_current_ticket:function(t){return function(){var e=(0,F.Z)(R().mark((function e(n){return R().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:T.KLx,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},set_current_ticket_status:function(t){return function(){var e=(0,F.Z)(R().mark((function e(n){return R().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:T.sg9,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_ticket_status:D},st=(0,E.$j)((function(t){return{all_tickets:t.support.all_tickets,current_ticket:t.support.current_ticket,running_ticket:t.support.running_ticket,archive_tickets:t.support.archive_tickets}}),rt)((function(t){var e=t.clear_current_ticket,n=t.set_all_support_messages_unread,r=t.set_current_ticket,i=t.current_ticket,u=t.running_ticket,l=t.archive_tickets,d=t.set_current_ticket_status,f=(0,a.useState)(!1),h=(0,I.Z)(f,2),m=h[0],v=h[1];(0,a.useEffect)((function(){u&&(r(u.id),d(u.status))}),[u]);var g=function(t){e(),n(),r(t.id),d(t.status)};return(0,K.jsx)(K.Fragment,{children:(0,K.jsxs)("div",{className:s,children:[u&&(0,K.jsx)(nt,{ticket:u,action:g,is_running:!0,active:i===u.id,first:!0}),(0,K.jsxs)("div",{className:"".concat(c," ").concat(o),onClick:function(){return v((function(t){return!t}))},children:[(0,K.jsx)("div",{children:"\u0410\u0440\u0445\u0438\u0432 \u0437\u0430\u044f\u0432\u043e\u043a"}),(0,K.jsx)("div",{className:m?_:"",children:(0,K.jsx)("img",{src:at,alt:""})})]}),(0,K.jsx)("div",{className:p,children:m&&(null===l||void 0===l?void 0:l.map((function(t,e){return(0,K.jsx)(nt,{ticket:t,action:g,is_running:(null===u||void 0===u?void 0:u.id)===t.id,active:i===t.id,first:0===e},e)})))})]})})})),ct={get_all_tickets:function(){return function(){var t=(0,F.Z)(R().mark((function t(e){var n,a;return R().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},t.prev=1,t.next=4,H().get("".concat("https://traveler.market","/api/support_tickets/\n"),n);case 4:a=t.sent,e({type:T.OSA,payload:a.data}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0),e({type:T.jt7,payload:t.t0.response.data});case 12:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},clear_current_ticket:q,set_all_support_messages_unread:G,clear_current_ticket_status:D},ot=(0,E.$j)((function(t){return{}}),ct)((function(t){var e=t.get_all_tickets,n=t.clear_current_ticket,s=t.set_all_support_messages_unread,c=t.clear_current_ticket_status;return(0,a.useEffect)((function(){return window.scrollTo(0,0),e(),function(){c(),n(),s()}}),[]),(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(tt.Z,{title:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430",menu_item:"support",page:"support",children:(0,K.jsxs)("div",{className:r,children:[(0,K.jsx)(st,{}),(0,K.jsx)(V,{})]})})})})),it=ot},5774:function(t,e){e.Z={chat_wrapper:"Chat_chat_wrapper__-v+H+",chat_contacts:"Chat_chat_contacts__aUILl",chat_contact_card:"Chat_chat_contact_card__Zowea",active:"Chat_active__XeqYQ",first:"Chat_first__8CnR6",chat_contact_wrapper:"Chat_chat_contact_wrapper__lRGqR",chat_contact_avatar:"Chat_chat_contact_avatar__S1eRN",active_user:"Chat_active_user__51HJ4",chat_contact_data:"Chat_chat_contact_data__LwNEi",chat_contact_name:"Chat_chat_contact_name__ZYt-E",chat_contact_last_message:"Chat_chat_contact_last_message__5bHE7",chat_contact_last_message_date:"Chat_chat_contact_last_message_date__XD1Ru",chat_messages:"Chat_chat_messages__d3BPR",chat_messages_messages:"Chat_chat_messages_messages__bucsV",message_wrapper:"Chat_message_wrapper__vEufx",is_mine:"Chat_is_mine__dtak2",user_avatar:"Chat_user_avatar__LvJnh",message_body:"Chat_message_body__o-Amj",message_header:"Chat_message_header__98fCG",message_author_name:"Chat_message_author_name__y5cko",message_date_time:"Chat_message_date_time__Gr8n0",message_text:"Chat_message_text__hK86q",message_status:"Chat_message_status__L2Yj2",send_button:"Chat_send_button__58LRa",editable_area:"Chat_editable_area__hI38S",tickets_button:"Chat_tickets_button__IYqHQ"}}}]);
//# sourceMappingURL=630.898098b0.chunk.js.map