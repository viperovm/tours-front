"use strict";(self.webpackChunkyour_app=self.webpackChunkyour_app||[]).push([[164],{7460:function(t,e,n){n.r(e),n.d(e,{default:function(){return P}});var r=n(2791),c="Support_chat_wrapper__8hf9N",s="Support_chat_contacts__C5H2I",a="Support_chat_contact_card__Ol9rB",u="Support_archive_handler__e6qKA",o="Support_active__GfWu4",i="Support_is_not_running__LzZSd",p="Support_chevron_rotated__IYB51",_="Support_first__Y-q5-",l="Support_chat_contact_wrapper__3nCTF",f="Support_chat_contact_data__jalI+",d="Support_chat_contact_name__yJMTC",v="Support_chat_contact_last_message__OHk4l",h="Support_chat_messages__1duyI",m="Support_chat_messages_messages__zEflC",k="Support_send_button__-HEwu",g="Support_tickets_button__r0erg",x=n(364),j=n(885),y=n(5087),w=n(5861),S=n(7757),Z=n.n(S),N=n(3605),C=n(4569),b=n.n(C),E=function(){return function(){var t=(0,w.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:N.cxF});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},F=function(){return function(){var t=(0,w.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:N.WLf});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},I=function(){return function(){var t=(0,w.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:N.GoZ});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},T=n(2948),$=n(8087),O=n(184),A=(0,x.$j)((function(t){return{}}),{})((function(t){var e=t.action,n=(0,r.useRef)(),c=(0,r.useState)(""),s=(0,j.Z)(c,2),a=s[0],u=s[1];return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e(a),u("")},children:[(0,O.jsx)(T.Z,{ref:n,placeholder:"\u0422\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",onChange:function(t){u(t.target.value)},value:a,maxRows:3}),(0,O.jsx)("button",{type:"submit",children:(0,O.jsx)("img",{src:$.Z,alt:""})})]})})})),J=n(1354),W=(0,x.$j)((function(t){return{user:t.auth.user,current_support_messages:t.support.current_support_messages}}),{})((function(t){var e=t.user,n=t.current_support_messages,c=(0,r.useRef)(null);return(0,r.useEffect)((function(){c&&c.current.addEventListener("DOMNodeInserted",(function(t){var e=t.currentTarget;e.scroll({top:e.scrollHeight,behavior:"smooth"})}))}),[n]),(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{ref:c,className:m,children:null===n||void 0===n?void 0:n.map((function(t,n){return(0,O.jsx)(J.Z,{data:t,author:t.author,user_id:e.id},n)}))})})})),H=(0,x.$j)((function(t){return{}}),{})((function(t){var e=t.active_ticket,n=void 0!==e&&e,r=t.action;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{className:g,onClick:function(){r(!n)},children:n?"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443"})})})),z={set_current_support_messages:function(t){return function(){var e=(0,w.Z)(Z().mark((function e(n){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:N.oqG,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_support_messages:function(){return function(){var t=(0,w.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:N.eVH});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_read:function(){return function(){var t=(0,w.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:N.EnG});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_unread:I,set_new_ticket:function(t){return function(){var e=(0,w.Z)(Z().mark((function e(n){var r,c,s;return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},c=JSON.stringify(t),e.prev=2,e.next=5,b().post("".concat("https://traveler.market","/api/support_tickets/"),c,r);case 5:s=e.sent,n({type:N.$1P,payload:s.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),n({type:N.o_8,payload:e.t0.response.data});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()}},G=(0,x.$j)((function(t){return{current_ticket:t.support.current_ticket,current_status:t.support.current_status}}),z)((function(t){var e=t.current_ticket,n=t.set_current_support_messages,c=t.clear_current_support_messages,s=t.set_all_support_messages_read,a=t.set_all_support_messages_unread,u=t.current_status,o=t.set_new_ticket;console.log(e),console.log(u);var i=(0,r.useState)(!1),p=(0,j.Z)(i,2),_=p[0],l=p[1],f=e?new y.w3cwebsocket("wss://traveler.market/ws/support_chat/".concat(e,"/?token=").concat(localStorage.getItem("access"))):null;(0,r.useEffect)((function(){return function(){c(),null===f||void 0===f||f.close()}})),(0,r.useEffect)((function(){f&&(f.onopen=function(){console.log("WebSocket Client Connected")},f.onclose=function(){console.log("WebSocket Client Disconnected")},f.onerror=function(t){console.error(t),console.log("Connection Error")},f.onmessage=function(t){var e=JSON.parse(t.data);e&&("set_read"===(null===e||void 0===e?void 0:e.command)?s():"set_unread"===(null===e||void 0===e?void 0:e.command)?a():n(e))})}),[f]);return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("div",{className:h,children:[3!==u&&(0,O.jsx)(H,{active_ticket:3!==(null===e||void 0===e?void 0:e.status),action:function(){return l((function(t){return!t}))}}),(0,O.jsx)(W,{}),(0,O.jsx)("div",{className:k,children:(3!==u||_)&&(0,O.jsx)(A,{action:function(t){_?o({text:t}):f.send(JSON.stringify({message:t}))},new_ticket:_})})]})})})),L=n(7714),q=n(5198),D=(0,x.$j)((function(t){return{}}),{})((function(t){var e=t.ticket,n=t.is_running,c=t.action,s=t.active,u=void 0!==s&&s,p=t.first,h=void 0!==p&&p,m=e.id,k=e.staff,g=e.last_message;(0,r.useEffect)((function(){n&&c(m)}),[n]);return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{className:"".concat(a," ").concat(u?o:""," ").concat(n?"":i," ").concat(h?_:""),onClick:function(){c(e)},children:(0,O.jsx)("div",{className:l,children:(0,O.jsxs)("div",{className:f,children:[(0,O.jsx)("div",{className:d,children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a #".concat(k)}),(0,O.jsx)("div",{className:v,children:(0,q.aF)(g,20)})]})})})})}));var R=n.p+"static/media/chevron_down.7ef6027d1679a7f457f31c202b92a83c.svg",B={clear_current_ticket:E,set_all_support_messages_unread:I,set_current_ticket:function(t){return function(){var e=(0,w.Z)(Z().mark((function e(n){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:N.KLx,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},set_current_ticket_status:function(t){return function(){var e=(0,w.Z)(Z().mark((function e(n){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:N.sg9,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_ticket_status:F},K=(0,x.$j)((function(t){return{all_tickets:t.support.all_tickets,current_ticket:t.support.current_ticket,running_ticket:t.support.running_ticket,archive_tickets:t.support.archive_tickets}}),B)((function(t){var e=t.clear_current_ticket,n=t.set_all_support_messages_unread,c=t.set_current_ticket,o=t.current_ticket,i=t.running_ticket,_=t.archive_tickets,l=t.set_current_ticket_status,f=(0,r.useState)(!1),d=(0,j.Z)(f,2),v=d[0],h=d[1],m=function(t){e(),n(),c(t.id),l(t.status)};return console.log(i),(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("div",{className:s,children:[i&&(0,O.jsx)(D,{ticket:i,action:m,is_running:!0,active:o===i.id,first:!0}),(0,O.jsxs)("div",{className:"".concat(a," ").concat(u),onClick:function(){return h((function(t){return!t}))},children:[(0,O.jsx)("div",{children:"\u0410\u0440\u0445\u0438\u0432 \u0437\u0430\u044f\u0432\u043e\u043a"}),(0,O.jsx)("div",{className:v?p:"",children:(0,O.jsx)("img",{src:R,alt:""})})]}),v&&(null===_||void 0===_?void 0:_.map((function(t,e){return(0,O.jsx)(D,{ticket:t,action:m,is_running:i.id===t.id,active:o===t.id,first:0===e},e)})))]})})})),M={get_all_tickets:function(){return function(){var t=(0,w.Z)(Z().mark((function t(e){var n,r;return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},t.prev=1,t.next=4,b().get("".concat("https://traveler.market","/api/support_tickets/\n"),n);case 4:r=t.sent,e({type:N.OSA,payload:r.data}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0),e({type:N.jt7,payload:t.t0.response.data});case 12:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},clear_current_ticket:E,set_all_support_messages_unread:I,clear_current_ticket_status:F},Y=(0,x.$j)((function(t){return{}}),M)((function(t){var e=t.get_all_tickets,n=t.clear_current_ticket,s=t.set_all_support_messages_unread,a=t.clear_current_ticket_status;return(0,r.useEffect)((function(){return window.scrollTo(0,0),e(),function(){a(),n(),s()}}),[]),(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(L.Z,{title:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430",menu_item:"support",page:"support",children:(0,O.jsxs)("div",{className:c,children:[(0,O.jsx)(K,{}),(0,O.jsx)(G,{})]})})})})),P=Y}}]);
//# sourceMappingURL=164.858832c4.chunk.js.map