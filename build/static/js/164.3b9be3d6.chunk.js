"use strict";(self.webpackChunkyour_app=self.webpackChunkyour_app||[]).push([[164],{7460:function(t,e,n){n.r(e),n.d(e,{default:function(){return U}});var r=n(2791),c="Support_chat_wrapper__8hf9N",s="Support_chat_contacts__C5H2I",a="Support_chat_contact_card__Ol9rB",u="Support_archive_handler__e6qKA",o="Support_active__GfWu4",i="Support_is_not_running__LzZSd",p="Support_chevron_rotated__IYB51",_="Support_archive_tickets__BTKR9",l="Support_first__Y-q5-",f="Support_chat_contact_wrapper__3nCTF",d="Support_chat_contact_data__jalI+",v="Support_chat_contact_name__yJMTC",h="Support_chat_contact_last_message__OHk4l",k="Support_chat_messages__1duyI",m="Support_chat_messages_messages__zEflC",g="Support_send_button__-HEwu",x="Support_tickets_button__r0erg",j=n(364),y=n(885),w=n(5087),S=n(5861),N=n(7757),Z=n.n(N),C=n(3605),b=n(4569),E=n.n(b),T=function(){return function(){var t=(0,S.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:C.cxF});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},F=function(){return function(){var t=(0,S.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:C.WLf});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},I=function(t){return function(){var e=(0,S.Z)(Z().mark((function e(n){var r,c;return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},null,e.prev=2,e.next=5,E().patch("".concat("https://traveler.market","/api/support_tickets/").concat(t,"/close_ticket/"),null,r);case 5:c=e.sent,n({type:C.DxN,payload:c.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),n({type:C.o_8,payload:e.t0.response.data});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},A=function(){return function(){var t=(0,S.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:C.GoZ});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},$=n(2948),J=n(8087),O=n(184),W=(0,j.$j)((function(t){return{}}),{})((function(t){var e=t.action,n=(0,r.useRef)(),c=(0,r.useRef)(),s=function(t){o?(t.preventDefault(),e(o),i("")):t.preventDefault()},a=(0,r.useState)(""),u=(0,y.Z)(a,2),o=u[0],i=u[1];return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("form",{ref:c,onSubmit:s,children:[(0,O.jsx)($.Z,{ref:n,placeholder:"\u0422\u0435\u043a\u0441\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f",onChange:function(t){i(t.target.value)},onKeyDown:function(t){13===t.keyCode&&!1===t.shiftKey&&s(t)},value:o,maxRows:3}),(0,O.jsx)("button",{type:"submit",children:(0,O.jsx)("img",{src:J.Z,alt:""})})]})})})),D=n(1354),z=(0,j.$j)((function(t){return{user:t.auth.user,current_support_messages:t.support.current_support_messages}}),{})((function(t){var e=t.user,n=t.current_support_messages,c=(0,r.useRef)(null);return(0,r.useEffect)((function(){c&&c.current.addEventListener("DOMNodeInserted",(function(t){var e=t.currentTarget;e.scroll({top:e.scrollHeight,behavior:"smooth"})}))}),[n]),(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{ref:c,className:m,children:null===n||void 0===n?void 0:n.map((function(t,n){return(0,O.jsx)(D.Z,{data:t,author:t.author,user_id:e.id},n)}))})})})),H={close_ticket:I},K=(0,j.$j)((function(t){return{}}),H)((function(t){var e=t.active_ticket,n=void 0!==e&&e,r=t.action;t.close_ticket;return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{className:x,onClick:function(){r()},children:n?"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443":"\u041e\u0442\u043a\u0440\u044b\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443"})})})),R={set_current_support_messages:function(t){return function(){var e=(0,S.Z)(Z().mark((function e(n){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:C.oqG,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_support_messages:function(){return function(){var t=(0,S.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:C.eVH});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_read:function(){return function(){var t=(0,S.Z)(Z().mark((function t(e){return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:C.EnG});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},set_all_support_messages_unread:A,set_new_ticket:function(t){return function(){var e=(0,S.Z)(Z().mark((function e(n){var r,c,s;return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},c=JSON.stringify(t),e.prev=2,e.next=5,E().post("".concat("https://traveler.market","/api/support_tickets/"),c,r);case 5:s=e.sent,n({type:C.$1P,payload:s.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),n({type:C.o_8,payload:e.t0.response.data});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},close_ticket:I,clear_current_ticket_status:F,clear_current_ticket:T},G=(0,j.$j)((function(t){return{current_ticket:t.support.current_ticket,current_status:t.support.current_status}}),R)((function(t){var e=t.current_ticket,n=t.set_current_support_messages,c=t.clear_current_support_messages,s=t.set_all_support_messages_read,a=t.set_all_support_messages_unread,u=t.current_status,o=t.set_new_ticket,i=t.close_ticket,p=t.clear_current_ticket_status,_=t.clear_current_ticket,l=(0,r.useState)(!1),f=(0,y.Z)(l,2),d=f[0],v=f[1],h=e?new w.w3cwebsocket("wss://traveler.market/ws/support_chat/".concat(e,"/?token=").concat(localStorage.getItem("access"))):null;(0,r.useEffect)((function(){return function(){c(),null===h||void 0===h||h.close()}})),(0,r.useEffect)((function(){h&&(h.onopen=function(){console.log("WebSocket Client Connected")},h.onclose=function(){console.log("WebSocket Client Disconnected")},h.onerror=function(t){console.error(t),console.log("Connection Error")},h.onmessage=function(t){var e=JSON.parse(t.data);e&&("set_read"===(null===e||void 0===e?void 0:e.command)?s():"set_unread"===(null===e||void 0===e?void 0:e.command)?a():n(e))})}),[h]);(0,r.useEffect)((function(){d&&(p(),_(),c())}),[d]);return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("div",{className:k,children:[(0,O.jsx)(K,{active_ticket:u&&3!==u,action:function(){u&&3!==u?(v(!1),i(e),p(),_(),c()):v((function(t){return!t}))}}),(0,O.jsx)(z,{}),(0,O.jsx)("div",{className:g,children:(u&&3!==u||d)&&(0,O.jsx)(W,{action:function(t){d?(v(!1),o({text:t})):h.send(JSON.stringify({message:t}))},new_ticket:d})})]})})})),L=n(7714),q=n(5198),B=(0,j.$j)((function(t){return{}}),{})((function(t){var e=t.ticket,n=t.is_running,c=t.action,s=t.active,u=void 0!==s&&s,p=t.first,_=void 0!==p&&p,k=e.id,m=e.staff,g=e.last_message;(0,r.useEffect)((function(){n&&c(k)}),[n]);return(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("div",{className:"".concat(a," ").concat(u?o:""," ").concat(n?"":i," ").concat(_?l:""),onClick:function(){c(e)},children:(0,O.jsx)("div",{className:f,children:(0,O.jsxs)("div",{className:d,children:[(0,O.jsx)("div",{className:v,children:"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a #".concat(m)}),(0,O.jsx)("div",{className:h,children:(0,q.aF)(g,20)})]})})})})}));var M=n.p+"static/media/chevron_down.7ef6027d1679a7f457f31c202b92a83c.svg",Y={clear_current_ticket:T,set_all_support_messages_unread:A,set_current_ticket:function(t){return function(){var e=(0,S.Z)(Z().mark((function e(n){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:C.KLx,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},set_current_ticket_status:function(t){return function(){var e=(0,S.Z)(Z().mark((function e(n){return Z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:C.sg9,payload:t});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},clear_current_ticket_status:F},P=(0,j.$j)((function(t){return{all_tickets:t.support.all_tickets,current_ticket:t.support.current_ticket,running_ticket:t.support.running_ticket,archive_tickets:t.support.archive_tickets}}),Y)((function(t){var e=t.clear_current_ticket,n=t.set_all_support_messages_unread,c=t.set_current_ticket,o=t.current_ticket,i=t.running_ticket,l=t.archive_tickets,f=t.set_current_ticket_status,d=(0,r.useState)(!1),v=(0,y.Z)(d,2),h=v[0],k=v[1];(0,r.useEffect)((function(){i&&(c(i.id),f(i.status))}),[i]);var m=function(t){e(),n(),c(t.id),f(t.status)};return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)("div",{className:s,children:[i&&(0,O.jsx)(B,{ticket:i,action:m,is_running:!0,active:o===i.id,first:!0}),(0,O.jsxs)("div",{className:"".concat(a," ").concat(u),onClick:function(){return k((function(t){return!t}))},children:[(0,O.jsx)("div",{children:"\u0410\u0440\u0445\u0438\u0432 \u0437\u0430\u044f\u0432\u043e\u043a"}),(0,O.jsx)("div",{className:h?p:"",children:(0,O.jsx)("img",{src:M,alt:""})})]}),(0,O.jsx)("div",{className:_,children:h&&(null===l||void 0===l?void 0:l.map((function(t,e){return(0,O.jsx)(B,{ticket:t,action:m,is_running:(null===i||void 0===i?void 0:i.id)===t.id,active:o===t.id,first:0===e},e)})))})]})})})),V={get_all_tickets:function(){return function(){var t=(0,S.Z)(Z().mark((function t(e){var n,r;return Z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(localStorage.getItem("access")),Accept:"application/json"}},t.prev=1,t.next=4,E().get("".concat("https://traveler.market","/api/support_tickets/\n"),n);case 4:r=t.sent,e({type:C.OSA,payload:r.data}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0),e({type:C.jt7,payload:t.t0.response.data});case 12:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},clear_current_ticket:T,set_all_support_messages_unread:A,clear_current_ticket_status:F},Q=(0,j.$j)((function(t){return{}}),V)((function(t){var e=t.get_all_tickets,n=t.clear_current_ticket,s=t.set_all_support_messages_unread,a=t.clear_current_ticket_status;return(0,r.useEffect)((function(){return window.scrollTo(0,0),e(),function(){a(),n(),s()}}),[]),(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(L.Z,{title:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430",menu_item:"support",page:"support",children:(0,O.jsxs)("div",{className:c,children:[(0,O.jsx)(P,{}),(0,O.jsx)(G,{})]})})})})),U=Q}}]);
//# sourceMappingURL=164.3b9be3d6.chunk.js.map